#
# ~/.bashrc
#

# set -o vi

export HISTFILE=~/.histfile
export HISTSIZE=10000
export HISTCONTROL="erasedups:ignorespace"

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

# Completion
set show-all-if-ambiguous on
if [[ -r /usr/share/bash-completion/bash_completion ]]; then
  . /usr/share/bash-completion/bash_completion
fi


export PATH="$HOME/.dotnet/tools:$PATH"
export PATH="$HOME/bin:$PATH"
export PATH="$PATH:$(go env GOBIN):$(go env GOPATH)/bin"
export PATH="$HOME/.config/emacs/bin:$PATH"
export EDITOR="nvim"

# Find in history with arrows by part of command
bind '"\e[A": history-search-backward'
bind '"\e[B": history-search-forward'

# Find with fzf in commands history
__fzf_history_search() {
    local selected_command
    selected_command=$(history | fzf --tac --no-sort +s --tiebreak=index --height 50% --reverse --query="$READLINE_LINE")
    if [ -n "$selected_command" ]; then
        READLINE_LINE=$(echo "$selected_command" | sed 's/^[ ]*[0-9]*[ ]*//')
        READLINE_POINT=${#READLINE_LINE}
    fi
}

# Call Ctrl+R for fzf history find
bind -x '"\C-r": __fzf_history_search'
bind -x '"\C-f": tmux-sessionizer'

alias ls='ls -lah --group-directories-first --color=auto --time-style="+%d.%m.%Y %H:%M:%S"'
alias grep='grep --color=auto'
alias ff='fastfetch'
alias cz='chezmoi'
alias czd='chezmoi diff --reverse'
alias lag='lazygit'
alias lad='lazydocker'
alias dl='dotnet-launcher'
alias dlef='dotnet-ef-launcher'
alias fabric='fabric-ai'
alias telos='cat telos.md | sed "1d;\$d" | age -d'
PS1='[\u@\h \W]\$ '

function y() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
        builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

cursor() {
    # Launch the system-installed cursor script in the background and disown it to prevent job control messages.
    nohup /usr/bin/cursor "$@" >/dev/null 2>&1 & disown
}

eval "$(starship init bash)"

# fastfetch
